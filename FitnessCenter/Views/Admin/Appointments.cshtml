@model List<FitnessCenter.Models.Appointment>
@{
    ViewData["Title"] = "Randevu Yönetimi";
    ViewData["NoTopPadding"] = true;
    var currentStatus = ViewBag.CurrentStatus as FitnessCenter.Models.AppointmentStatus?;
}

<style>
    .admin-page {
        min-height: 100vh;
        padding-top: 100px;
        padding-bottom: 60px;
        background: linear-gradient(135deg, #0a0a14 0%, #0f0f1a 100%);
    }

    .page-header {
        margin-top: 20px;
        margin-bottom: 40px;
    }

    .page-header h1 {
        font-size: 2rem;
        font-weight: 700;
        color: #fff;
        margin-bottom: 5px;
    }

    .page-header h1 i { color: #00d26a; margin-right: 10px; }

    .page-header p {
        color: #888;
        margin: 0;
    }

    .filter-card {
        background: linear-gradient(145deg, #12121c 0%, #0d0d14 100%);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 25px;
    }

    .filter-btn {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #b8b8b8;
        padding: 10px 20px;
        border-radius: 10px;
        font-weight: 500;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        margin-right: 8px;
        margin-bottom: 8px;
    }

    .filter-btn:hover {
        background: rgba(255, 255, 255, 0.08);
        color: #fff;
    }

    .filter-btn.active-all {
        background: rgba(0, 210, 106, 0.15);
        border-color: #00d26a;
        color: #00d26a;
    }

    .filter-btn.active-pending {
        background: rgba(245, 158, 11, 0.15);
        border-color: #f59e0b;
        color: #f59e0b;
    }

    .filter-btn.active-confirmed {
        background: rgba(0, 210, 106, 0.15);
        border-color: #00d26a;
        color: #00d26a;
    }

    .filter-btn.active-completed {
        background: rgba(59, 130, 246, 0.15);
        border-color: #3b82f6;
        color: #3b82f6;
    }

    .filter-btn.active-cancelled {
        background: rgba(239, 68, 68, 0.15);
        border-color: #ef4444;
        color: #ef4444;
    }

    .table-card {
        background: linear-gradient(145deg, #12121c 0%, #0d0d14 100%);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 20px;
        overflow: hidden;
    }

    .table-custom {
        margin: 0;
        color: #fff;
    }

    .table-custom thead {
        background: rgba(0, 210, 106, 0.05);
    }

    .table-custom thead th {
        border: none;
        padding: 15px 20px;
        font-weight: 600;
        color: #b8b8b8;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .table-custom tbody tr {
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.3s ease;
    }

    .table-custom tbody tr:hover {
        background: rgba(0, 210, 106, 0.03);
    }

    .table-custom tbody tr:last-child {
        border-bottom: none;
    }

    .table-custom tbody td {
        padding: 15px 20px;
        vertical-align: middle;
        border: none;
        color: #e0e0e0;
    }

    .badge-pending { background: rgba(245, 158, 11, 0.15); color: #f59e0b; padding: 6px 12px; border-radius: 8px; font-weight: 500; }
    .badge-confirmed { background: rgba(0, 210, 106, 0.15); color: #00d26a; padding: 6px 12px; border-radius: 8px; font-weight: 500; }
    .badge-cancelled { background: rgba(239, 68, 68, 0.15); color: #ef4444; padding: 6px 12px; border-radius: 8px; font-weight: 500; }
    .badge-completed { background: rgba(59, 130, 246, 0.15); color: #3b82f6; padding: 6px 12px; border-radius: 8px; font-weight: 500; }

    .price-tag { color: #00d26a; font-weight: 600; }

    .btn-action {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: none;
        transition: all 0.3s ease;
        margin-right: 5px;
    }

    .btn-action.confirm { background: rgba(0, 210, 106, 0.15); color: #00d26a; }
    .btn-action.confirm:hover { background: #00d26a; color: #0a0a14; }
    .btn-action.cancel { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
    .btn-action.cancel:hover { background: #ef4444; color: #fff; }
    .btn-action.complete { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
    .btn-action.complete:hover { background: #3b82f6; color: #fff; }
    .btn-action.revert { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
    .btn-action.revert:hover { background: #f59e0b; color: #0a0a14; }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #888;
    }

    .empty-state i {
        font-size: 3rem;
        color: rgba(0, 210, 106, 0.3);
        margin-bottom: 15px;
    }
</style>

<div class="admin-page">
    <div class="container">
        <div class="page-header" data-aos="fade-down">
            <h1><i class="bi bi-calendar-check-fill"></i> Randevu Yönetimi</h1>
            <p>Randevuları yönetin</p>
        </div>

        <!-- Filter Buttons -->
        <div class="filter-card" data-aos="fade-up">
            <a asp-action="Appointments" class="filter-btn @(currentStatus == null ? "active-all" : "")">
                <i class="bi bi-grid-3x3-gap me-1"></i> Tümü
            </a>
            <a asp-action="Appointments" asp-route-status="@FitnessCenter.Models.AppointmentStatus.Pending" 
               class="filter-btn @(currentStatus == FitnessCenter.Models.AppointmentStatus.Pending ? "active-pending" : "")">
                <i class="bi bi-clock me-1"></i> Beklemede
            </a>
            <a asp-action="Appointments" asp-route-status="@FitnessCenter.Models.AppointmentStatus.Confirmed" 
               class="filter-btn @(currentStatus == FitnessCenter.Models.AppointmentStatus.Confirmed ? "active-confirmed" : "")">
                <i class="bi bi-check-circle me-1"></i> Onaylı
            </a>
            <a asp-action="Appointments" asp-route-status="@FitnessCenter.Models.AppointmentStatus.Completed" 
               class="filter-btn @(currentStatus == FitnessCenter.Models.AppointmentStatus.Completed ? "active-completed" : "")">
                <i class="bi bi-check-all me-1"></i> Tamamlanan
            </a>
            <a asp-action="Appointments" asp-route-status="@FitnessCenter.Models.AppointmentStatus.Cancelled" 
               class="filter-btn @(currentStatus == FitnessCenter.Models.AppointmentStatus.Cancelled ? "active-cancelled" : "")">
                <i class="bi bi-x-circle me-1"></i> İptal
            </a>
        </div>

        <div class="table-card" data-aos="fade-up" data-aos-delay="100">
            @if (Model.Count == 0)
            {
                <div class="empty-state">
                    <i class="bi bi-calendar-x"></i>
                    <p class="mb-0">Randevu bulunamadı.</p>
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table table-custom">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tarih</th>
                                <th>Saat</th>
                                <th>Üye</th>
                                <th>Antrenör</th>
                                <th>Hizmet</th>
                                <th>Ücret</th>
                                <th>Durum</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var apt in Model)
                            {
                                <tr>
                                    <td>@apt.Id</td>
                                    <td>@apt.AppointmentDate.ToString("dd.MM.yyyy")</td>
                                    <td>@apt.AppointmentTime.ToString(@"hh\:mm") - @apt.EndTime.ToString(@"hh\:mm")</td>
                                    <td><strong>@apt.User?.FullName</strong></td>
                                    <td>@apt.Trainer?.FullName</td>
                                    <td>@apt.Service?.Name</td>
                                    <td><span class="price-tag">@apt.TotalPrice.ToString("N0") ₺</span></td>
                                    <td>
                                        @{
                                            var badgeClass = apt.Status switch
                                            {
                                                FitnessCenter.Models.AppointmentStatus.Pending => "badge-pending",
                                                FitnessCenter.Models.AppointmentStatus.Confirmed => "badge-confirmed",
                                                FitnessCenter.Models.AppointmentStatus.Cancelled => "badge-cancelled",
                                                FitnessCenter.Models.AppointmentStatus.Completed => "badge-completed",
                                                _ => ""
                                            };
                                            var statusText = apt.Status switch
                                            {
                                                FitnessCenter.Models.AppointmentStatus.Pending => "Beklemede",
                                                FitnessCenter.Models.AppointmentStatus.Confirmed => "Onaylı",
                                                FitnessCenter.Models.AppointmentStatus.Cancelled => "İptal",
                                                FitnessCenter.Models.AppointmentStatus.Completed => "Tamamlandı",
                                                _ => "Bilinmiyor"
                                            };
                                        }
                                        <span class="@badgeClass">@statusText</span>
                                    </td>
                                    <td>
                                        @if (apt.Status == FitnessCenter.Models.AppointmentStatus.Pending)
                                        {
                                            <form asp-action="ConfirmAppointment" asp-route-id="@apt.Id" method="post" class="d-inline">
                                                <button type="submit" class="btn-action confirm" title="Onayla">
                                                    <i class="bi bi-check-lg"></i>
                                                </button>
                                            </form>
                                            <form asp-action="CancelAppointment" asp-route-id="@apt.Id" method="post" class="d-inline">
                                                <button type="submit" class="btn-action cancel" title="İptal Et">
                                                    <i class="bi bi-x-lg"></i>
                                                </button>
                                            </form>
                                        }
                                        else if (apt.Status == FitnessCenter.Models.AppointmentStatus.Confirmed)
                                        {
                                            <form asp-action="CompleteAppointment" asp-route-id="@apt.Id" method="post" class="d-inline">
                                                <button type="submit" class="btn-action complete" title="Tamamlandı">
                                                    <i class="bi bi-check-all"></i>
                                                </button>
                                            </form>
                                            <form asp-action="RevertAppointmentToPending" asp-route-id="@apt.Id" method="post" class="d-inline">
                                                <button type="submit" class="btn-action revert" title="Beklemede Yap">
                                                    <i class="bi bi-arrow-counterclockwise"></i>
                                                </button>
                                            </form>
                                            <form asp-action="CancelAppointment" asp-route-id="@apt.Id" method="post" class="d-inline">
                                                <button type="submit" class="btn-action cancel" title="İptal Et">
                                                    <i class="bi bi-x-lg"></i>
                                                </button>
                                            </form>
                                        }
                                        else if (apt.Status == FitnessCenter.Models.AppointmentStatus.Completed)
                                        {
                                            <form asp-action="RevertAppointmentToConfirmed" asp-route-id="@apt.Id" method="post" class="d-inline">
                                                <button type="submit" class="btn-action revert" title="Onaylandı Yap">
                                                    <i class="bi bi-arrow-counterclockwise"></i>
                                                </button>
                                            </form>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>
</div>
