@model FitnessCenter.Models.ViewModels.AIRecommendationViewModel
@{
    ViewData["Title"] = "Yapay Zeka Önerileri";
}

<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="fw-bold"><i class="bi bi-robot text-primary"></i> Yapay Zeka Fitness Asistanı</h1>
        <p class="text-muted lead">Kişisel fitness ve beslenme önerilerinizi alın</p>
    </div>

    <div class="row">
        <!-- Sol Taraf - Form -->
        <div class="col-md-5">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-person-lines-fill"></i> Bilgilerinizi Girin</h5>
                </div>
                <div class="card-body">
                    <form asp-action="GetRecommendation" method="post" id="aiForm">
                        <div class="mb-3">
                            <label asp-for="Height" class="form-label">Boy (cm)</label>
                            <div class="input-group">
                                <input asp-for="Height" type="number" class="form-control" placeholder="175" min="100" max="250">
                                <span class="input-group-text">cm</span>
                            </div>
                            <span asp-validation-for="Height" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Weight" class="form-label">Kilo (kg)</label>
                            <div class="input-group">
                                <input asp-for="Weight" type="number" step="0.1" class="form-control" placeholder="70" min="30" max="300">
                                <span class="input-group-text">kg</span>
                            </div>
                            <span asp-validation-for="Weight" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Age" class="form-label">Yaş</label>
                            <input asp-for="Age" type="number" class="form-control" placeholder="25" min="10" max="100">
                            <span asp-validation-for="Age" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="BodyType" class="form-label">Vücut Tipi</label>
                            <select asp-for="BodyType" class="form-select">
                                <option value="">Seçin...</option>
                                <option value="Ectomorph">Ektomorf (İnce yapılı)</option>
                                <option value="Mesomorph">Mezomorf (Atletik)</option>
                                <option value="Endomorph">Endomorf (Geniş yapılı)</option>
                            </select>
                            <span asp-validation-for="BodyType" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="FitnessGoal" class="form-label">Fitness Hedefiniz</label>
                            <select asp-for="FitnessGoal" class="form-select">
                                <option value="">Seçin...</option>
                                <option value="WeightLoss">Kilo Vermek</option>
                                <option value="MuscleGain">Kas Kazanmak</option>
                                <option value="Endurance">Dayanıklılık Arttırmak</option>
                                <option value="Flexibility">Esneklik Geliştirmek</option>
                                <option value="GeneralFitness">Genel Fitness</option>
                            </select>
                            <span asp-validation-for="FitnessGoal" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="ActivityLevel" class="form-label">Aktivite Seviyesi</label>
                            <select asp-for="ActivityLevel" class="form-select">
                                <option value="">Seçin...</option>
                                <option value="Sedentary">Hareketsiz (Masa başı iş)</option>
                                <option value="LightlyActive">Az Aktif (Hafif egzersiz)</option>
                                <option value="ModeratelyActive">Orta Aktif (3-5 gün spor)</option>
                                <option value="VeryActive">Çok Aktif (Günlük spor)</option>
                                <option value="ExtremelyActive">Aşırı Aktif (Profesyonel sporcu)</option>
                            </select>
                            <span asp-validation-for="ActivityLevel" class="text-danger"></span>
                        </div>

                        <div class="mb-4">
                            <label asp-for="HealthConditions" class="form-label">Sağlık Durumu (Opsiyonel)</label>
                            <textarea asp-for="HealthConditions" class="form-control" rows="2" 
                                      placeholder="Varsa kronik hastalık, alerji vb."></textarea>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                                <i class="bi bi-magic"></i> Öneri Al
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- BMI Hesaplama -->
            <div class="card shadow-sm mt-4">
                <div class="card-header">
                    <h6 class="mb-0"><i class="bi bi-calculator"></i> Vücut Kitle İndeksi (BMI)</h6>
                </div>
                <div class="card-body">
                    <div id="bmiResult" class="text-center py-3">
                        <p class="text-muted">Boy ve kilo bilgilerini girin</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sağ Taraf - Sonuçlar -->
        <div class="col-md-7">
            @if (!string.IsNullOrEmpty(Model?.Recommendation))
            {
                <!-- Öneriler -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-lightning"></i> Kişiselleştirilmiş Öneriler</h5>
                    </div>
                    <div class="card-body">
                        <div class="recommendation-content">
                            @Html.Raw(Model.Recommendation?.Replace("\n", "<br>"))
                        </div>
                    </div>
                </div>

                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i>
                    <strong>Not:</strong> Bu öneriler genel bilgi amaçlıdır. Detaylı program için antrenörlerimize danışmanızı öneririz.
                    <a asp-controller="Trainer" asp-action="Index" class="alert-link">Antrenörlerimizi inceleyin</a>
                </div>
            }
            else
            {
                <div class="card shadow-sm h-100">
                    <div class="card-body d-flex flex-column justify-content-center align-items-center text-center py-5">
                        <i class="bi bi-robot display-1 text-muted mb-4"></i>
                        <h4 class="text-muted">Kişiselleştirilmiş Öneriler</h4>
                        <p class="text-muted">
                            Soldaki formu doldurarak yapay zeka destekli kişiselleştirilmiş 
                            egzersiz ve beslenme önerilerinizi alabilirsiniz.
                        </p>
                        <div class="row mt-4 text-start w-100">
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-check-circle-fill text-success me-2 fs-4"></i>
                                    <span>Vücut tipinize özel egzersizler</span>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-check-circle-fill text-success me-2 fs-4"></i>
                                    <span>Hedeflerinize yönelik program</span>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-check-circle-fill text-success me-2 fs-4"></i>
                                    <span>Kişiselleştirilmiş beslenme planı</span>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-check-circle-fill text-success me-2 fs-4"></i>
                                    <span>Günlük kalori hesaplama</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        const heightInput = document.getElementById('Height');
        const weightInput = document.getElementById('Weight');
        const bmiResult = document.getElementById('bmiResult');

        function calculateBMI() {
            const height = parseFloat(heightInput.value) / 100; // cm to m
            const weight = parseFloat(weightInput.value);

            if (height > 0 && weight > 0) {
                const bmi = weight / (height * height);
                let category, colorClass;

                if (bmi < 18.5) {
                    category = 'Zayıf';
                    colorClass = 'text-info';
                } else if (bmi < 25) {
                    category = 'Normal';
                    colorClass = 'text-success';
                } else if (bmi < 30) {
                    category = 'Fazla Kilolu';
                    colorClass = 'text-warning';
                } else {
                    category = 'Obez';
                    colorClass = 'text-danger';
                }

                bmiResult.innerHTML = `
                    <h2 class="${colorClass}">${bmi.toFixed(1)}</h2>
                    <p class="${colorClass} mb-0"><strong>${category}</strong></p>
                    <div class="progress mt-3" style="height: 10px;">
                        <div class="progress-bar bg-info" style="width: 18.5%"></div>
                        <div class="progress-bar bg-success" style="width: 6.5%"></div>
                        <div class="progress-bar bg-warning" style="width: 5%"></div>
                        <div class="progress-bar bg-danger" style="width: 70%"></div>
                    </div>
                    <div class="d-flex justify-content-between mt-1">
                        <small>18.5</small>
                        <small>25</small>
                        <small>30</small>
                    </div>
                `;
            }
        }

        heightInput.addEventListener('input', calculateBMI);
        weightInput.addEventListener('input', calculateBMI);

        // Form submit loading
        document.getElementById('aiForm').addEventListener('submit', function() {
            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Analiz Ediliyor...';
        });
    </script>
}

<style>
    .recommendation-content {
        line-height: 1.8;
    }
    .recommendation-content br {
        margin-bottom: 0.5rem;
    }
</style>
